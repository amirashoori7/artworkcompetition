<!-- Multi step form -->
<script>
	$(document).ready(
			function() {
				$.ajax({
					url : "{% url 'artwork:entry_form' %}",
					success : function(response) {
						$("#artwork-submit-form-holder-id").html(response)
						$("#registrationForm").load(
								'/account/register/',
								function() {
									$("#register-btn").on("click",
											function(ev) {
												ev.preventDefault()
												submitRegistryForm()
											})
								})
						$('#entry-form-id').submit(function(event) {
							event.preventDefault()
							submitEntryForm()
						})
						// 										$("input")
						// 												.each(
						// 														function() {
						// 															if ($(this).val().length == 0) {
						// 																console.log($(this).attr("id"))
						// 																populateWarningMessageField(
						// 																		$(this)
						// 																				.attr(
						// 																						"id"),
						// 																		"To enter the competition, this field must be filled.")
						// 															}
						// 														})
						var maxYear = 2008, minYear = 2003
						var month = [ 'January', 'February', 'March', 'April',
								'May', 'June', 'July', 'August', 'September',
								'October', 'November', 'December' ]
						$("<option/>").val("").text("Year").prop("disabled",
								true).prop("selected", true).appendTo(
								"#yearDropDown")
						while (maxYear >= minYear) {
							$("<option/>").val(maxYear).text(maxYear).appendTo(
									"#yearDropDown")
							maxYear = maxYear - 1
						}
						$("<option/>").val("").text("Day").prop("disabled",
								true).prop("selected", true).appendTo(
								"#dayDropDown")
						for (var i = 1; i < 32; i++)
							$("<option/>").val(i).text(i).appendTo(
									"#dayDropDown")
						$("<option/>").val("").text("Month").prop("disabled",
								true).prop("selected", true).appendTo(
								"#monthDropDown")
						for (var i = 1; i < 13; i++)
							$("<option/>").val(i).text(month[i - 1]).appendTo(
									"#monthDropDown")

						$("#school-div-container").fadeOut()
						$(".school-option-class").hide()
					},
					error : function(request, status, error) {
						console.log(request.responseText);
					}
				});
			})

	function submitRegistryForm() {
		var form = $('#registry-form')[0];
		$("#register-btn").prop("disabled", true);
		var data = new FormData(form);
		$
				.ajax({
					type : "POST",
					enctype : 'multipart/form-data',
					data : data,
					processData : false,
					contentType : false,
					cache : false,
					timeout : 60000,
					url : "{% url 'account:register' %}",
					beforeSend : function(xhr, settings) {
						if (!(/^http:.*/.test(settings.url) || /^https:.*/
								.test(settings.url))) {
							xhr.setRequestHeader("X-CSRFToken",
									getCookie('csrftoken'));
						}
					},
					success : function(response) {
						if (response.successResult != null) {
							$("#id").val(response.id)
							toggleMessageBox(response.successResult, false)
							$(".form-signin.form-general-style").find(
									"input#inputEmail").val(
									$("#registry-form").find("input#username")
											.val())
							$(".form-signin.form-general-style").find(
									"input#inputPassword").val(
									$("#registry-form").find("input#password1")
											.val())
							$(".form-signin.form-general-style").submit()
							loadContent($("<li/>").attr({
								"data-href" : "/signup_page/"
							}))
						} else if (response.errorResult != null) {
							$("#id").val(0)
							var errorList = $("<ul/>");
							populateErrorMessageFields(response.errorResult)
							toggleMessageBox(
									"<span>Registration unsuccessful. <br>Please fill the following fields:</span>"
											+ $('<div>').append(
													errorList.clone()).html(),
									true)

						}
					},
					error : function(xhr, errmsg, err) {
						console.log(xhr.status + ": " + xhr.responseText)
						toggleMessageBox(xhr.responseText, true)
					},
					complete : function(response) {
						$("#register-btn").prop("disabled", false);
						return -1
					}
				})
	}

	function submitEntryForm() {
		var form = $('#entry-form-id')[0];
		$("#buttonSubmit").prop("disabled", true);
		var data = new FormData(form);
		$
				.ajax({
					type : "POST",
					enctype : 'multipart/form-data',
					data : data,
					processData : false,
					contentType : false,
					cache : false,
					timeout : 60000,
					url : "{% url 'artwork:entry_form' %}",
					beforeSend : function(xhr, settings) {
						if (!(/^http:.*/.test(settings.url) || /^https:.*/
								.test(settings.url))) {
							xhr.setRequestHeader("X-CSRFToken",
									getCookie('csrftoken'));
						}
						$("#dob").val(
								$("#monthDropDown").val() + "/"
										+ $("#dayDropDown").val() + "/"
										+ $("#yearDropDown").val())
					},
					success : function(response) {
						console.log(response)
						if (response.successResult != null) {
							$("#id").val(response.id)
							toggleMessageBox(response.successResult, false)
						}
						if (response.errorResultUser != null)
							populateErrorMessageFields(response.errorResultUser)
						if (response.errorResultWork != null) {
							populateErrorMessageFields(response.errorResultWork)
							$("#id").val(0)
						}
					},
					error : function(xhr, errmsg, err) {
						console.log(xhr.status + ": " + xhr.responseText)
						toggleMessageBox(xhr.responseText, true)
					},
					complete : function(response) {
						$("#buttonSubmit").prop("disabled", false)
						return -1
					}
				})
	}
</script>
{% if user.is_authenticated %}
<div class="page-title">
	<h2>Entry Form</h2>
</div>
<section class="multi_step_form" id="artwork-submit-form-holder-id">
</section>
{% else %}
<div class="page-title">
	<h2>Register</h2>
</div>
<div class="row">
	<div class="col-md-12" id="registrationForm"></div>
</div>
{% endif %}
