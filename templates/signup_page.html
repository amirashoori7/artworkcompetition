<!-- Multi step form -->
<script>
	function fetchEntryForm() {
		$.ajax({
			url : "{% url 'artwork:entry_form' %}",
			success : function(response) {
				$("#region-dropdownDIV").fadeOut()
				$("#schoolDIV").fadeOut()
				$("#artwork-submit-form-holder-id").html(response)
				getSchoolVal(1)
				if($("#currentlearnergrade").val().length > 0) 
					$.each($("input[name='learnergrade']"), function(i, val){
						   $("input[value='" + $("#currentlearnergrade").val() + "']").prop('checked', true)
					});
				$('#entry-form-id').submit(function(event) {
					event.preventDefault()
					submitEntryForm()
				})
				$("#school-div-container").fadeOut()
				$(".school-option-class").hide()
			},
			error : function(request, status, error) {
				console.log(request.responseText);
			}
		});
	}
	$(document).ready(function() {
		{% if user.is_authenticated %}
		fetchEntryForm()
		{% else %}
		$("#registrationForm").load('/account/register/', function() {
			$("#register-btn").on("click", function(ev) {
				ev.preventDefault()
				submitRegistryForm()
			})
		})
		{% endif %}
	})

	function submitRegistryForm() {
		var form = $('#registry-form')[0];
		$("#register-btn").prop("disabled", true);
		var data = new FormData(form);
		$
				.ajax({
					type : "POST",
					enctype : 'multipart/form-data',
					data : data,
					processData : false,
					contentType : false,
					cache : false,
					timeout : 60000,
					url : "{% url 'account:register' %}",
					beforeSend : function(xhr, settings) {
						if (!(/^http:.*/.test(settings.url) || /^https:.*/
								.test(settings.url))) {
							xhr.setRequestHeader("X-CSRFToken",
									getCookie('csrftoken'));
						}
					},
					success : function(response) {
						if (response.successResult != null) {
							toggleMessageBox(response.successResult, false)
							$(".form-signin.form-general-style").find(
									"input#inputEmail").val(
									$("#registry-form").find("input#username")
											.val())
							$(".form-signin.form-general-style").find(
									"input#inputPassword").val(
									$("#registry-form").find("input#password1")
											.val())
							$(".form-signin.form-general-style").submit()
							loadContent($("<li/>").attr({
								"data-href" : "/signup_page/"
							}))
						} else if (response.errorResult != null) {
							$("#registry-form").find("small").remove()
							populateErrorMessageFields(response.errorResult)
							toggleMessageBox(
									"<span>Registration unsuccessful.</span>",
									true)

						}
					},
					error : function(xhr, errmsg, err) {
						console.log(xhr.status + ": " + xhr.responseText)
						toggleMessageBox(xhr.responseText, true)
					},
					complete : function(response) {
						$("#register-btn").prop("disabled", false);
						return -1
					}
				})
	}

	function submitEntryForm() {
		var form = $('#entry-form-id')[0];
		$("#buttonSubmit").prop("disabled", true);
		var data = new FormData(form);
		$
				.ajax({
					type : "POST",
					enctype : 'multipart/form-data',
					data : data,
					processData : false,
					contentType : false,
					cache : false,
					timeout : 60000,
					url : "{% url 'artwork:entry_form' %}",
					beforeSend : function(xhr, settings) {
						if (!(/^http:.*/.test(settings.url) || /^https:.*/
								.test(settings.url))) {
							xhr.setRequestHeader("X-CSRFToken",
									getCookie('csrftoken'));
						}
					},
					success : function(response) {
						if (response.successResult != null) {
							$("#id").val(response.id)
							toggleMessageBox(response.successResult, false)
						}
						if (response.errorResultUser != null)
							populateErrorMessageFields(response.errorResultUser)
						if (response.errorResultWork != null) {
							populateErrorMessageFields(response.errorResultWork)
							$("#id").val(0)
						}
					},
					error : function(xhr, errmsg, err) {
						console.log(xhr.status + ": " + xhr.responseText)
						toggleMessageBox(xhr.responseText, true)
					},
					complete : function(response) {
						$("#buttonSubmit").prop("disabled", false)
						return -1
					}
				})
	}
</script>
{% if user.is_authenticated %}

<div class="page-title">
	<h4>Entry Form</h4>
</div>
<div class="row">
	<div class="col-md-2"></div>
	<div class="col-md-8" id="artwork-submit-form-holder-id"></div>
</div>
</section>
{% else %}
<div class="page-title">
	<h4>Register</h4>
</div>
<div class="row">
	<div class="col-md-2"></div>
	<div class="col-md-8" id="registrationForm"></div>
</div>
{% endif %}
