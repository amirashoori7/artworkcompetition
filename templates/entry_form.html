<script type="text/javascript">
	var Cropper = window.Cropper;
	var aspectRatio = 1.414 //A4 paper

	function createCroppie(w, h) {
		$("#main-cropper")
				.append(
						"<span>Use the scroll wheel of your mouse to resize the image</span>");
		var basic = $('#main-cropper').croppie({
			viewport : {
				width : $("#main-cropper").width() * 6 / 7,
				height : $("#main-cropper").width() * 6 / 14
			},
			boundary : {
				width : $("#main-cropper").width(),
				height : $("#main-cropper").width() / 2
			},
			showZoomer : true
		});
	}

	function readFile(input) {
		var filesToUploads = document.getElementById('workfile').files;
		$("#cropIcon").fadeIn()
		var file = filesToUploads[0];
		if (input.files && input.files[0]) {
			if (input.files[0].size > 5000000) {
				$('#workfile').val('')
			}
			var reader = new FileReader();
			reader.onload = function(e) {
				var image = new Image();
				var img = document.createElement("img");
				img.src = e.target.result;

				var canvas = document.createElement("canvas");
				var ctx = canvas.getContext("2d");
				ctx.drawImage(img, 0, 0);

				var MAX_WIDTH = 400;
				var MAX_HEIGHT = 400;
				var width = img.width;
				var height = img.height;

				if (width > height) {
					if (width > MAX_WIDTH) {
						height *= MAX_WIDTH / width;
						width = MAX_WIDTH;
					}
				} else {
					if (height > MAX_HEIGHT) {
						width *= MAX_HEIGHT / height;
						height = MAX_HEIGHT;
					}
				}
				canvas.width = width;
				canvas.height = height;
				var ctx = canvas.getContext("2d");
				ctx.drawImage(img, 0, 0, width, height);
				dataurl = canvas.toDataURL(file.type);
				$('#main-cropper').croppie('bind', {
					url : e.target.result
				})
				$('#croppedImage').attr('src', dataurl)
			}
			reader.readAsDataURL(input.files[0]);
			$("#imagefilesize").val(input.files[0].size)
		} else {
			toggleMessageBox("Sorry - you're browser doesn't support the FileReader API",
					true);
		}
	}

	$('#cropIcon').on('click', function(ev) {
		$('#main-cropper').croppie('result', {
			type : 'canvas',
			size : 'viewport',
			format : 'jpeg'
		}).then(function(resp) {
			$("#croppedImage").attr('src', resp)
			$("#workfileCropped").val(resp)
			return false
		});
		$("#main-cropper").empty()
		return false
	})
	var allowedTypes = [ 'image/jpeg', 'image/jpg', 'image/png' ];
	$("#workfile")
			.change(
					function() {
						$("#main-cropper").empty();
						var input = this
						var filesToUploads = this.files;
						var file = filesToUploads[0]
						var fileType = file.type
						$("small.workfile").remove()
						if (!allowedTypes.includes(fileType)) {
							populateDangerMessageField("workfile",
									'Please select a valid file format (JPEG, JPG or PNG).');
							$("#workfile").val('')
							return false
						}
						$("#imagefilesize").val(input.files[0].size)
						if (input.files && input.files[0]) {
							if (input.files[0].size > 5000000) {
								populateDangerMessageField("workfile",
										"The file size cannot be larger than 5MB.")
								$('#workfile').val('')
								return false
							}
						}
						readURL(this, '.artwork-image')
						$(".progress").css("display", "flex")
						// createCroppie();
						// readFile(this);
					})

	$("#workformulafile")
			.change(
					function() {
						$("#main-cropper").empty();
						var input = this
						var filesToUploads = this.files;
						var file = filesToUploads[0]
						var fileType = file.type
						$("small.workfile").remove()
						if (!allowedTypes.includes(fileType)) {
							populateDangerMessageField("workfile",
									'Please select a valid file format (JPEG or JPG).');
							$("#workfile").val('')
							return false
						}
						$("#imagefilesize").val(input.files[0].size)
						if (input.files && input.files[0]) {
							if (input.files[0].size > 5000000) {
								populateDangerMessageField("workfile",
										"The file size cannot be larger than 5MB.")
								$('#workfile').val('')
								return false
							}
						}
						readURL(this, '.formula-image')
						$(".progress").css("display", "flex")
						// createCroppie();
						// readFile(this);
					})

	function readURL(input, classNameStr) {
		if (input.files && input.files[0]) {
			var reader = new FileReader();
			reader.onload = function(e) {
				$(classNameStr).find("img").remove()
				$(classNameStr).append(
						$("<img/>").attr('src', e.target.result).css({
							"width" : "100%",
							"height" : "auto"
						}))
			}
			reader.readAsDataURL(input.files[0]);
		}
	}
</script>
<style>
.entry-form-warning {
	margin: 11px;
	font-size: 14px;
	font-weight: bold;
}

.card-header {
	cursor: pointer;
	text-align: center;
	font-weight: bold;
}

.card-header:before {
	font-family: "Font Awesome 5 Free";
	content: "\f068";
	float: right;
	position: absolute;
	font-weight: 900;
}

.card-header.collapsed:before {
	content: "\f067";
}

#footer-form-btns {
	position: sticky;
	bottom: 0;
	left: 0;
	right: 0;
	padding: 11px;
	background: white;
}

.disabled {
	pointer-events: none;
}

.progress {
	display: none;
}
</style>
<div class="row">
	<div class="col-sm-1"></div>
	<div class="col-sm-8">
		<h5>
			<strong style="font-style: italic;">Entry Status: </strong>
			<!-- 			STATUS TITLE -->
			{{ form.instance.get_status_display }}
		</h5>
	</div>
</div>
<hr />
<div class="row">
	{% if form.instance.status == 1 %}
	<div class="col-sm-12 card" style="border-color: #dc3545 !important;">
		<h6 class="text-danger">
			<strong style="font-style: italic;">Comment: </strong>{{ form.instance.comment }}
		</h6>
		{% if form.instance.bioapproved == False %}
		<h6 class="text-danger">Bio Requires Revision</h6>
		{% endif %} {% if form.instance.workapproved == False %}
		<h6 class="text-danger">Artwork Requires Revision</h6>
		{% endif %} {% if form.instance.qapproved == False %}
		<h6 class="text-danger">Questions Require Revision</h6>
		{% endif %}
	</div>
	{% endif %}
</div>
<hr />
<div class="row">
	<div class="col-md-12">
		<form method="post" id="entry-form-id"
			action="{% url 'artwork:entry_form' %}"
			class="was-validated form-general-style"
			enctype="multipart/form-data" novalidate>
			{% csrf_token %} <input type="hidden" name="id" id="id"
				value="{{ form.instance.id|default:'0' }}">
			<div class="card">

				<!-- 				BIO  -->
				<div class="card-header collapsed row" data-toggle="collapse"
					aria-expanded="false" href="#profile-section">
					<div class="col-md-11">
						<a class="card-title"><i class="fa fa-user"></i>&nbsp;My
							Profile</a>
					</div>
					<div class="col-md-1">
						<i class="fa status"></i>
					</div>
				</div>
				<div class="row collapse card-body" id="profile-section">


					<!-- 					EMAIL -->


					<div class="form-group col-md-6">
						<label for="username"> Username </label> <input type="email"
							data-required="1" class="form-control" placeholder="Email"
							required autocomplete="off" id="username" name="username"
							disabled="disabled" value="{{ user.username|default:'' }}">
					</div>

					<!-- 				CELLPHONE -->

					<div class="form-group col-md-6">
						<label for="cellphone">Cell Phone Number</label> <input
							data-required="1" type="tel" class="form-control"
							placeholder="012 345 67 89" required="required" id="cellphone"
							value="{{ user.cellphone|default:'' }}" name="Cellphone Number">
					</div>




					<!-- 					NAME -->


					<div class="form-group col-md-6">
						<label for="first_name">First Name </label> <input
							data-required="1" type="text" class="form-control"
							placeholder="i.e. Joe" required id="first_name" name="first_name"
							value="{{ user.first_name | default:'' }}">
					</div>
					<!-- 				SURNAME -->

					<div class="form-group col-md-6">
						<label for="last_name">Last Name</label> <input data-required="1"
							type="text" class="form-control" placeholder="i.e. Scholtz"
							required id="last_name" value="{{ user.last_name | default:'' }}"
							name="last_name">
					</div>




					<!-- 					Date of Birth -->


					<div class="form-group col-md-6">
						<label for="first_name">Date of Birth</label> <input
							data-required="1" type="date" class="form-control" required
							id="dob" name="dob" value="{{ user.dob|default:'' }}">
					</div>




					<!-- 					PARENT NAME -->


					<div class="form-group col-md-6">
						<label for="first_name">Parent/Guardian's Full-Name</label> <input
							data-required="1" type="text" class="form-control"
							placeholder="i.e. Jack Scholtz" required id="parentname"
							name="parentname" value="{{ user.parentname|default:'' }}">
					</div>



					<!-- 				PARENT PHONE NUMBER -->

					<div class="form-group col-md-6">
						<label for="first_name">Parent/Guardian's Cell phone
							Number</label> <input data-required="1" type="tel" class="form-control"
							name="parentphone" placeholder="012 345 67 89" id="parentphone"
							value="{{ user.parentphone|default:'' }}" required>
					</div>


					<!-- 				PARENT EMAIL ADDRESS-->



					<div class="form-group col-md-6">
						<label for="parentemail">Parent/Guardian's Email Address</label> <input
							type="email" class="form-control" id="parentemail"
							name="parentemail" placeholder="you@example.com"
							value="{{ user.parentemail|default:'' }}">
					</div>
				</div>
			</div>


			<!-- 			SCHOOL -->

			<hr />

			<div class="card">
				<div class="card-header collapsed row" data-toggle="collapse"
					aria-expanded="false" href="#school-section">
					<div class="col-md-11">
						<a class="card-title"><i class="fa fa-school"></i>&nbsp;My
							School</a>
					</div>
					<div class="col-md-1">
						<i class="fa status"></i>
					</div>
				</div>
				<div class="collapse card-body" id="school-section"
					data-title="My School">
					<div class="row">
						<div class="form-group col-md-6">
							<label for="province-dropdown">Province of School</label> <select
								class="form-control form-input" id="province-dropdown"
								onchange="getSchoolVal(2)" required>
								<option value="" selected="selected" disabled="disabled">Select</option>
							</select>
						</div>
						<div class="form-group col-md-6 " id="schoolDIV">
							<label for="school-dropdown">School Name</label> <select
								class="form-control form-input disabled selectpicker"
								id="school-dropdown" data-live-search="true"
								onchange="$('#school-id-val').val($('#school-dropdown').val())">
								<option value="1" selected="selected" disabled="disabled">{{ form.instance.school.name|default:'Select School' }}
									School</option>

							</select>
						</div>
						<input type="hidden" name="school"
							value="{{ form.instance.school.id|default:'0' }}"
							id="school-id-val" data-required="1">
						<input type="hidden" 
							value="{{ form.instance.school.province|default:'0' }}"
							id="province-id-val">
					</div>
					<div class="row">
						<div class="col-md-12">
							<span class="text-warning">Can't find your school? </span> <span
								class="text-secondary">Tell Us, your province, region and
								school name.</span>
							<button class="btn btn-sm btn-link"
								onclick="loadContent($('<li/>').attr('data-href','/contactus'))">Contact
								Us</button>
							<span>
						</div>
					</div>
					<hr>
					<div class="row">
						<input type="hidden" data-required="1"
							class="form-control form-input" id="currentlearnergrade"
							value="{{ form.instance.learnergrade|default:'' }}" required
							name="learnergrade">
						<!-- 						RADIOS -->
						<div class="col-md-2 btn-group btn-group-toggle btn-sm"
							data-toggle="buttons">
							<label class="btn btn-outline-secondary btn-group btn-group-sm">
								<input type="radio" name="learnergradeRadio" value="Grade 7"
								onclick="gradeChose(this)">Grade 7
							</label>
						</div>
						<div class="col-md-2 btn-group btn-group-toggle btn-sm"
							data-toggle="buttons">
							<label class="btn btn-outline-secondary btn-group btn-group-sm">
								<input type="radio" name="learnergradeRadio" value="Grade 8"
								onclick="gradeChose(this)"> Grade 8
							</label>
						</div>
						<div class="col-md-2 btn-group btn-group-toggle btn-sm"
							data-toggle="buttons">
							<label class="btn btn-outline-secondary btn-group btn-group-sm">
								<input type="radio" name="learnergradeRadio" value="Grade 9"
								onclick="gradeChose(this)"> Grade 9
							</label>
						</div>
						<div class="col-md-2 btn-group btn-group-toggle btn-sm"
							data-toggle="buttons">
							<label class="btn btn-outline-secondary btn-group btn-group-sm">
								<input type="radio" name="learnergradeRadio" value="Grade 10"
								onclick="gradeChose(this)"> Grade 10
							</label>
						</div>
						<div class="col-md-2 btn-group btn-group-toggle btn-sm"
							data-toggle="buttons">
							<label class="btn btn-outline-secondary btn-group btn-group-sm">
								<input type="radio" name="learnergradeRadio" value="Grade 11"
								onclick="gradeChose(this)"> Grade 11
							</label>
						</div>
						<div class="col-md-2 btn-group btn-group-toggle btn-sm"
							data-toggle="buttons">
							<label class="btn btn-outline-secondary btn-group btn-group-sm">
								<input type="radio" name="learnergradeRadio" value="Grade 12"
								onclick="gradeChose(this)"> Grade 12
							</label>
						</div>
						<!-- 				</div> -->
					</div>
					<hr>
					<div class="row">
						<div class="form-group col-md-4">
							<label for="teachername">Teacher's Name</label> <input
								type="text" data-required="1" class="form-control form-input"
								id="teachername" name="teachername"
								placeholder="i.e. Edvard Harry"
								value="{{ form.instance.teachername|default_if_none:'' }}"
								required>
						</div>
						<div class="form-group col-md-4">
							<label for="teacheremail">Teacher's Email</label> <input
								type="email" class="form-control form-input" id="teacheremail"
								name="teacheremail" placeholder="you@example.com"
								data-required="1"
								value="{{ form.instance.teacheremail|default_if_none:'' }}"
								required>
						</div>
						<div class="form-group col-md-4">
							<label for="teacherphone">Teacher's Phone</label> <input
								type="tel" class="form-control form-input" id="teacherphone"
								name="teacherphone" placeholder="012 345 67 89"
								value="{{ form.instance.teacherphone|default_if_none:'' }}">
						</div>
					</div>
				</div>
			</div>



			<hr />

			<!-- 			UPLOAD ARTWORK -->


			<div class="card">
				<div class="card-header collapsed row" data-toggle="collapse"
					aria-expanded="false" href="#artwork-section">
					<div class="col-md-11">
						<a class="card-title"><i class="fa fa-palette"></i>&nbsp;My
							Artwork</a>
					</div>
					<div class="col-md-1">
						<i class="fa fa-status"></i>
					</div>
				</div>
				<div class="collapse card-body" id="artwork-section"
					data-title="Upload my artwork">

					<div class="row">
						<div class="col-md-12">
							<label for="worktitle">Title of my artwork</label> <input
								type="text" data-required="1" class="form-control form-input"
								id="worktitle" name="worktitle"
								placeholder="I would like to call my artwork (Max 10 words)"
								value="{{ form.instance.worktitle|default_if_none:'' }}"
								required>
						</div>
					</div>
					<hr>
					<div class="row">
						<div class="col-md-6" id="">
							<label for="workfile">Upload image of my artwork</label> <input
								type="file" class="form-control form-input" id="workfile"
								name="workfile" placeholder="" data-required="1"
								accept="image/*" required> <input type="hidden"
								name="imagefilesize" id="imagefilesize" value="0">
						</div>
						<div class="col-md-12 artwork-image">
							{% if form.instance.workfile %}
							<script type="text/javascript">
								$("#workfile").removeAttr('data-required')
							</script>
							<img src="{{ form.instance.workfile.url }}" width="100%"
								height="auto"> {% endif %}
						</div>
						<div class="col-md-12">
							<div id="main-cropper">
								<img src="{{ form.instance.workfileCropped }}">
							</div>
							<div id="iconCropDiv">
								<img id="croppedImage" src="" alt="" /> <input type="hidden"
									class="form-control form-input" id="workfileCropped"
									name="workfileCropped" placeholder="" value=""
									value="{{ form.instance.workfileCropped|default_if_none:'' }}"
									required>
							</div>
							<button class="cropIcon" id="cropIcon" style="display: none">Crop</button>
						</div>
					</div>
				</div>
			</div>




			<!-- 			QUESTIONS -->

			<hr />


			<div class="card questions-card">
				<div class="card-header collapsed row" data-toggle="collapse"
					aria-expanded="false" href="#questions-section">
					<div class="col-md-11">
						<a class="card-title"><i class="fa fa-square-root-alt"></i>&nbsp;Questions</a>
					</div>
					<div class="col-md-1">
						<i class="fa fa-status"></i>
					</div>
				</div>
				<div class="collapse card-body" id="questions-section"
					data-title="Answering questions">
					<div class="row">
						<div class="col-md-12">
							<label for="question1"> <strong>Question 1: </strong>What
								Mathematics did you use in your artwork? (Explain your answer)
							</label> <span class="word-counter question1"></span>
							<textarea class="form-control form-input questions"
								data-required="1" required
								placeholder="Explain it in 50-100 words" id="question1"
								name="question1" rows="5">{{ form.instance.question1|default_if_none:'Answer 1' }}</textarea>
						</div>
					</div>
					<hr>
					<div class="row">
						<div class="col-md-12">
							<label for="question2"> <strong>Question 2:</strong> How
								did you creatively connect Mathematics with "My Universe" to
								make your artwork? (Explain your answer)
							</label> <span class="word-counter question2"></span>
							<textarea class="form-control form-input questions"
								id="question2" required data-required="1"
								placeholder="Explain it in 50-100 words" name="question2"
								rows="5">{{ form.instance.question2|default_if_none:'Answer 2' }}</textarea>
						</div>
					</div>
					<hr>
					<div class="row">
						<div class="col-md-12">
							<label for="workformulafile">If a photo of your
								mathematics would help your explanation, upload an image here
								(*optional)</label> <input type="file" class="form-control form-input"
								id="workformulafile" name="workformulafile" placeholder=""
								value="Browse"
								value="{{ form.instance.workformulafile|default_if_none:'' }}"
								accept="image/*">
						</div>
						<div class="col-md-12 formula-image">
							{% if form.instance.workformulafile %} <img
								src="{{ form.instance.workformulafile.url }}" width="100%"
								height="auto"> {% endif %}
						</div>
					</div>
					<hr>
					<div class="row">
						<div class="col-md-12">
							<label for="question3"> <strong>Question 3:</strong> Do
								you think creativity could be used to teach Mathematics?
								(Explain your answer)
							</label> <span class="word-counter question3"></span>
							<textarea class="form-control form-input questions"
								id="question3" required="required" data-required="1"
								placeholder="Explain it in 35-100 words" name="question3"
								rows="5">{{ form.instance.question3|default_if_none:'Answer 3' }}</textarea>
						</div>
					</div>
				</div>
			</div>
			{% if form.instance.status == -1 or form.instance.status == 1%}
			<div class="row" id="footer-form-btns">
				<div class="col-md-6 text-center" data-toggle="tooltip"
					data-placement="top" title="Fill the required forms to activate me">
					<button class="btn btn-outline-secondary btn-sm col-md-12 disabled"
						type="button" id="buttonSubmit">Submit</button>
				</div>
				<div class="col-md-6 text-center">
					<button class="btn btn-outline-primary btn-sm col-md-12"
						type="button" id="buttonSaveContinue">Save & Continue
						Later</button>
				</div>
				<div class="col-md-12 progress">
					<div
						class="progress-bar progress-bar-striped progress-bar-animated"
						role="progressbar" aria-valuenow="0" aria-valuemin="0"
						aria-valuemax="100"></div>
				</div>
			</div>
			{% endif %}
		</form>
	</div>
</div>
