<script src="static/js/croppie.js"></script>
<link rel="stylesheet" href="static/css/croppie.css"
	crossorigin="anonymous">
<script type="text/javascript">
	var Cropper = window.Cropper;
	var aspectRatio = 1.414 //A4 paper

	function createCroppie() {
		$("#main-cropper")
				.append(
						"<span>Use the scroll wheel of your mouse to resize the image</span>");
		var basic = $('#main-cropper').croppie({
			viewport : {
				width : $("#main-cropper").width() * 6 / 7,
				height : $("#main-cropper").width() * 6 / 14
			},
			boundary : {
				width : $("#main-cropper").width(),
				height : $("#main-cropper").width() / 2
			},
			showZoomer : true
		});
		console.log($("#entry-form-id").width())
		// 		basic.croppie('bind', {
		// 			url : 'images/NMMU_logo.png'
		// 		});
	}

	function readFile(input) {
		var filesToUploads = document.getElementById('workfile').files;
		$("#cropIcon").fadeIn()
		var file = filesToUploads[0];
		if (input.files && input.files[0]) {
			var reader = new FileReader();
			reader.onload = function(e) {
				var image = new Image();
				var img = document.createElement("img");
				img.src = e.target.result;

				var canvas = document.createElement("canvas");
				var ctx = canvas.getContext("2d");
				ctx.drawImage(img, 0, 0);

				var MAX_WIDTH = 400;
				var MAX_HEIGHT = 400;
				var width = img.width;
				var height = img.height;

				if (width > height) {
					if (width > MAX_WIDTH) {
						height *= MAX_WIDTH / width;
						width = MAX_WIDTH;
					}
				} else {
					if (height > MAX_HEIGHT) {
						width *= MAX_HEIGHT / height;
						height = MAX_HEIGHT;
					}
				}
				canvas.width = width;
				canvas.height = height;
				var ctx = canvas.getContext("2d");
				ctx.drawImage(img, 0, 0, width, height);
				dataurl = canvas.toDataURL(file.type);
				$('#main-cropper').croppie('bind', {
					url : e.target.result
				})
				$('#croppedImage').attr('src', dataurl)
			}
			reader.readAsDataURL(input.files[0]);
		} else {
			toggleMessageBox(
					"Sorry - you're browser doesn't support the FileReader API",
					true);
		}
	}

	$("#workfile").change(function() {
		$("#main-cropper").empty();
		createCroppie();
		readFile(this);
	});

	$('#cropIcon').on('click', function(ev) {
		$('#main-cropper').croppie('result', {
			type : 'canvas',
			size : 'viewport',
			format : 'jpeg'
		}).then(function(resp) {
			$("#croppedImage").attr('src', resp)
			$("#workfileCropped").val(resp)
			return false
		});
		$("#main-cropper").empty()
		return false
	});
	function filterSchool(stateId) {
		$("#school-div-container").fadeIn()
		$(".school-option-class").each(function() {
			if ($(this).attr("data-state") === stateId)
				$(this).show()
			else
				$(this).hide()
		})
	}
</script>
<div class="row">
	<div class="col-md-12">
		<form method="post" id="entry-form-id" action="/"
			class="needs-validation form-general-style"
			enctype="multipart/form-data" novalidate>
			{% csrf_token %} <input type="hidden" name="id" id="id"
				value="{{ form.instance.id|default_if_none:'' }}">

			<!-- 				BIO  -->

			<div class="form-section" data-title="Personal Information">
				<div class="row">
					<div class="col-md-6">
						<label for="username">Username</label>
						<input type="text" class="form-control form-input" id="username"
							name="username"
							value="{{ user.username }}" disabled="disabled">
					</div>
					
					<div class="col-md-6">
						<label for="email">Email</label>
						<input type="text" class="form-control form-input" id="email"
							name="email" value="{{ user.email }}" disabled="disabled">
					</div>
				</div>
				<div class="row">
					<div class="col-md-4">
						<label for="firstname">First Name</label>
						<input type="text" class="form-control form-input" id="firstname"
							name="firstname" placeholder="i.e. John   i.e. Amy"
							value="{{ user.first_name}}" required>
					</div>
					<div class="col-md-4">
						<label for="surname">Surname</label>
						<input type="text" class="form-control form-input" id="surname"
							name="surname" placeholder="i.e. Scholtz"
							value="{{ user.last_name }}" required>
					</div>
					<div class="col-md-4">
						<label for="cellphone">Cellphone</label>
						<input type="tel" class="form-control form-input" id="cellphone"
							name="cellphone" placeholder="012 345 67 89"
							value="{{ form.instance.cellphone|default_if_none:'012 345 67 89' }}"
							required>
					</div>
				</div>
				<div class="row" id="dob-row">
					<div class="col-md-4">
						<label for="yearDropDown">Date of Birth</label>
						<input type="hidden" class="form-control form-input" id="dob"
							placeholder="" name="dob"
							value="{{ form.instance.dob|default_if_none:'' }}" required>
						<select id="yearDropDown" class="form-control form-input">
						</select>
					</div>
					<div class="col-md-4">
						<label for="monthDropDown">&nbsp;</label>
						<select id="monthDropDown" class="form-control form-input">
						</select>
					</div>
					<div class="col-md-4">
						<label for="dayDropDown">&nbsp;</label>
						<select id="dayDropDown" class="form-control form-input">
						</select>
					</div>
				</div>
			</div>




			<!-- 			PARENT INFO -->





			<div class="form-section" data-title="Parent (Guardian) Information">
				<div class="row">
					<div class="col-md-6">
						<label for="parentname">Parent (Guardian) Full-Name</label>
						<input type="text" class="form-control form-input" id="parentname"
							name="parentname" placeholder="i.e. Jack Scholtz"
							value="{{ form.instance.parentname|default_if_none:'Jack Scholtz' }}"
							required>
					</div>
					<div class="col-md-6">
						<label for="parentphone">Parent (Guardian)'s Phone Number</label>
						<input type="tel" class="form-control form-input" id="parentphone"
							name="parentphone" placeholder="012 345 67 89"
							value="{{ form.instance.parentphone|default_if_none:'012 345 67 89' }}"
							required>
					</div>
				</div>
				<div class="row">
					<div class="col-md-6">
						<label for="parentemail">Guardian (Parent)'s Email Address</label>
						<input type="email" class="form-control form-input"
							id="parentemail" name="parentemail" placeholder="you@example.com"
							value="{{ form.instance.parentemail|default_if_none:'you@example.com' }}"
							required>
					</div>
				</div>
			</div>




			<!-- 			SCHOOL -->





			<div class="form-section" data-title="My School">
				<div class="row">
					<div class="col-md-4">
						<label for="states-dropdown">Province of School (Estate)</label>
						<select class="form-control form-input" id="states-dropdown"
							onchange="filterSchool($(this).val())">
							<option value="" selected="selected" disabled="disabled">Select</option>
							<option value="0">Eastern Cape</option>
							<option value="1">Free State</option>
							<option value="2">Gauteng</option>
							<option value="3">KwaZulu-Natal</option>
							<option value="4">Limpopo</option>
							<option value="5">Mpumalanga</option>
							<option value="6">North West</option>
							<option value="7">Northern Cape</option>
							<option value="8">Western Cape</option>
						</select>
					</div>
					<div class="col-md-4">
						<label for="states-dropdown">Town</label>
						<select class="form-control form-input" id="states-dropdown"
							onchange="filterSchool($(this).val())">
							<option value="" selected="selected" disabled="disabled">Select</option>
							<option value="0">Eastern Cape</option>
							<option value="1">Free State</option>
							<option value="2">Gauteng</option>
							<option value="3">KwaZulu-Natal</option>
							<option value="4">Limpopo</option>
							<option value="5">Mpumalanga</option>
							<option value="6">North West</option>
							<option value="7">Northern Cape</option>
							<option value="8">Western Cape</option>
						</select>
					</div>
					<div class="col-md-4" id="school-div-container">
						<label for="school-dropdown">School</label>
						<input type="hidden" name="school" id="school"
							value="{{ form.instance.school|default_if_none:'' }}" required>
						<select class="form-control form-input" id="school-dropdown"
							onchange="$('#school').val($('#school-dropdown').val())">
							<option value="" class="school-option-class">Choose...</option>
							{% for sch in schools %}
							<option value="{{ sch.id }}" data-state="{{ sch.province }}"
								class="school-option-class">{{ sch.name }} {% endfor %}
						</select>
					</div>
				</div>
			</div>




			<!-- 			GRADE -->





			<div class="form-section" data-title="My Grade">
				<div class="row">
					<div class="col-md-2">
						<label for="learnergrade7">Grade 7</label>
						<input type="hidden" class="form-control form-input"
							id="currentlearnergrade"
							value="{{ form.instance.learnergrade|default_if_none:'' }}"
							required> <input type="radio" checked
							class="form-control form-input" id="learnergrade"
							name="learnergrade" value="Grade 7">
					</div>
					<div class="col-md-2">
						<label for="learnergrade8">Grade 8</label>
						<input type="radio" class="form-control form-input"
							id="learnergrade8" name="learnergrade" value="Grade 8">
					</div>
					<div class="col-md-2">
						<label for="learnergrade9">Grade 9</label>
						<input type="radio" class="form-control form-input"
							id="learnergrade9" name="learnergrade" value="Grade 9">
					</div>
					<div class="col-md-2">
						<label for="learnergrade10">Grade 10</label>
						<input type="radio" class="form-control form-input"
							id="learnergrade10" name="learnergrade" value="Grade 10">
					</div>
					<div class="col-md-2">
						<label for="learnergrade11">Grade 11</label>
						<input type="radio" class="form-control form-input"
							id="learnergrade11" name="learnergrade" value="Grade 11">
					</div>
					<div class="col-md-2">
						<label for="learnergrade12">Grade 12</label>
						<input type="radio" class="form-control form-input"
							id="learnergrade12" name="learnergrade" value="Grade 12">
					</div>
				</div>
			</div>





			<!-- 			TEACHER'S INFO -->





			<div class="form-section" data-title="My Teacher">
				<div class="row">
					<div class="col-md-4">
						<label for="teachername">Teacher Name</label>
						<input type="text" class="form-control form-input"
							id="teachername" name="teachername"
							placeholder="i.e. Edvard Harry"
							value="{{ form.instance.teachername|default_if_none:'Teacher Name' }}"
							required>
					</div>
					<div class="col-md-4">
						<label for="teacheremail">Teacher Email</label>
						<input type="email" class="form-control form-input"
							id="teacheremail" name="teacheremail"
							placeholder="you@example.com"
							value="{{ form.instance.teacheremail|default_if_none:'you@example.com' }}"
							required>
					</div>
					<div class="col-md-4">
						<label for="teacherphone">Teacher Phone</label>
						<input type="tel" class="form-control form-input"
							id="teacherphone" name="teacherphone" placeholder="012 345 67 89"
							value="{{ form.instance.teacherphone|default_if_none:'0123456789' }}"
							required>
					</div>
				</div>
			</div>





			<!-- 			UPLOAD ARTWORK -->





			<div class="form-section" data-title="Upload my artwork">
				<div class="row">
					<div class="col-md-12">
						<label for="surname">Work Title</label>
						<input type="text" class="form-control form-input" id="worktitle"
							name="worktitle"
							placeholder="I would like to call my artwork (Max 10 words)"
							value="{{ form.instance.worktitle|default_if_none:'' }}" required>
					</div>
				</div>

				<div class="row">
					<div class="col-md-2" id="h-v-label">Vertical</div>
					<div class="col-md-2" id="">
						<label class="switch"> <input type="checkbox" checked>
							<span class="slider round"></span>
						</label>
					</div>
					<div class="col-md-2" id="">Horizontal</div>
					<div class="col-md-6" id="">
						<label for="workfile">Upload Work File</label>
						<input type="file" class="form-control form-input" id="workfile"
							name="workfile" placeholder="" value="Browse"
							value="{{ form.instance.workfile|default_if_none:'' }}"
							accept="image/*" required>
					</div>
					<div class="col-md-12">
						<div id="main-cropper"><img src="{{ form.instance.workfileCropped }}"></div>
						<div id="iconCropDiv">
							<img id="croppedImage" src="" alt="" /> <input type="hidden"
								class="form-control form-input" id="workfileCropped"
								name="workfileCropped" placeholder="" value=""
								value="{{ form.instance.workfileCropped|default_if_none:'' }}"
								required>
						</div>
						<button class="cropIcon" id="cropIcon" style="display: none">Crop</button>
					</div>
				</div>
			</div>





			<!-- 			QUESTIONS -->





			<div class="form-section" data-title="Answering questions">
				<div class="row">
					<div class="col-md-6">
						<label for="question1"> <strong>Question 1: </strong>What
						Mathematics did you use in your artwork? (Explain your answer)</label>
						<textarea class="form-control form-input"
							placeholder="Explain it in 50-100 words" id="question1"
							name="question1" rows="5">{{ form.instance.question1|default_if_none:'Answer 1' }}</textarea>
					</div>
					<div class="col-md-6">
						<label for="formulafile">Upload Mathematics Image</label>
						<input type="file" class="form-control form-input"
							id="workformulafile" name="workformulafile" placeholder=""
							value="Browse"
							value="{{ form.instance.workformulafile|default_if_none:'' }}"
							accept="image/*" required>
					</div>
				</div>
				<div class="row">
					<div class="col-md-6">
						<label for="question2"> <strong>Question 2:</strong> How
						creatively you connected the Mathematics with "My Universe"
						to make your artwork? (Explain your answer)</label>
						<textarea class="form-control form-input" id="question2"
							placeholder="Explain it in 50-100 words" name="question2"
							rows="5">{{ form.instance.question2|default_if_none:'Answer 2' }}</textarea>
					</div>
					<div class="col-md-6">
						<label for="question3"> <strong>Question 3:</strong> Do
						you think creativity could be used to teach Mathematics? (Explain your answer)</label>
						<textarea class="form-control form-input" id="question3"
							placeholder="Explain it in 50-100 words" name="question3"
							rows="5">{{ form.instance.question3|default_if_none:'Answer 3' }}</textarea>
					</div>
				</div>
			</div>
			<div class="col-md-12 text-center">
				<button class="action-button" type="submit" id="buttonSubmit">Submit</button>
			</div>
		</form>
	</div>
</div>
